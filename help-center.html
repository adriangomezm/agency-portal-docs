<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agency Portal Help Center</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
@font-face {
  font-family: 'Polymath Text';
  src: url('fonts/PolymathTextDemo-Medium.otf') format('opentype');
  font-weight: 500;
  font-style: normal;
}
@font-face {
  font-family: 'Polymath Text';
  src: url('fonts/PolymathTextDemo-Bold.otf') format('opentype');
  font-weight: 700;
  font-style: normal;
}

:root {
  --purple-deep: #230F59;
  --purple-mid: #3D1F8E;
  --purple-light: #6B4FCF;
  --purple-pale: #E8E0F5;
  --sage: #B8D4C8;
  --lavender: #C5CAE9;
  --pink: #F0B8D0;
  --amber: #F0A830;
  --cream: #FAF8F5;
  --white: #FFFFFF;
  --text-dark: #1A1A1A;
  --text-secondary: #6B6B6B;
  --text-light: #9B9B9B;
  --border: #E8E4DF;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
  --shadow-hover: 0 6px 20px rgba(0,0,0,0.12);
  --radius: 12px;
  --radius-sm: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Polymath Text', 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--text-dark);
  background: var(--cream);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* --- HEADER --- */
.header {
  background: linear-gradient(135deg, var(--purple-deep) 0%, var(--purple-mid) 50%, var(--purple-light) 100%);
  position: relative;
  overflow: hidden;
}

.header-decor {
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0.06;
}
.header-decor::before {
  content: '';
  position: absolute;
  width: 400px; height: 400px;
  border: 2px solid #fff;
  border-radius: 50%;
  top: -180px; right: -80px;
}
.header-decor::after {
  content: '';
  position: absolute;
  width: 300px; height: 300px;
  border: 2px solid #fff;
  border-radius: 50%;
  bottom: -120px; left: -60px;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 40px;
  position: relative;
  z-index: 2;
}

.header-logo {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  color: #fff;
}
.header-logo svg { height: 28px; width: auto; }
.header-logo-text {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 18px;
  font-weight: 600;
  letter-spacing: -0.3px;
}

.header-nav {
  display: flex;
  gap: 24px;
  align-items: center;
}
.header-nav a {
  color: rgba(255,255,255,0.8);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: color 0.2s;
}
.header-nav a:hover { color: #fff; }

.header-content {
  text-align: center;
  padding: 48px 40px 56px;
  position: relative;
  z-index: 2;
}
.header-content h1 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 32px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 24px;
  letter-spacing: -0.5px;
}

.search-box {
  max-width: 600px;
  margin: 0 auto;
  position: relative;
}
.search-box input {
  width: 100%;
  padding: 14px 20px 14px 48px;
  border: none;
  border-radius: 50px;
  font-size: 15px;
  font-family: inherit;
  background: rgba(255,255,255,0.95);
  color: var(--text-dark);
  outline: none;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  transition: box-shadow 0.2s;
}
.search-box input::placeholder { color: var(--text-light); }
.search-box input:focus { box-shadow: 0 4px 24px rgba(0,0,0,0.2); }
.search-box .search-icon {
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-light);
}

/* --- HEADER COMPACT (Collection & Article pages) --- */
.header.compact .header-content {
  padding: 24px 40px 32px;
}
.header.compact .header-content h1 { font-size: 26px; margin-bottom: 16px; }

/* --- MAIN CONTENT --- */
.main {
  max-width: 960px;
  margin: 0 auto;
  padding: 40px 24px 80px;
}

/* --- BREADCRUMBS --- */
.breadcrumbs {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 32px;
  font-size: 14px;
}
.breadcrumbs a {
  color: var(--purple-mid);
  text-decoration: none;
  font-weight: 500;
}
.breadcrumbs a:hover { text-decoration: underline; }
.breadcrumbs .sep { color: var(--text-light); }
.breadcrumbs .current { color: var(--text-secondary); }

/* --- COLLECTION GRID (Homepage) --- */
.collections-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}

.collection-card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 28px;
  cursor: pointer;
  border: 1px solid var(--border);
  transition: box-shadow 0.25s, transform 0.25s;
}
.collection-card:hover {
  box-shadow: var(--shadow-hover);
  transform: translateY(-2px);
}

.collection-card-icon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 16px;
  font-size: 24px;
}

.collection-card h3 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 17px;
  font-weight: 600;
  color: var(--purple-deep);
  margin-bottom: 8px;
}

.collection-card p {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.5;
  margin-bottom: 16px;
}

.collection-card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-light);
}
.collection-card-meta .avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--lavender);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 700;
  color: var(--purple-deep);
}

/* --- COLLECTION PAGE (Article List) --- */
.collection-header {
  display: flex;
  align-items: flex-start;
  gap: 20px;
  margin-bottom: 32px;
}
.collection-header-icon {
  width: 56px;
  height: 56px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  flex-shrink: 0;
}
.collection-header-info h2 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 24px;
  font-weight: 700;
  color: var(--text-dark);
  margin-bottom: 4px;
}
.collection-header-info .meta {
  font-size: 14px;
  color: var(--text-secondary);
}

.article-list { list-style: none; }
.article-list li {
  border-bottom: 1px solid var(--border);
}
.article-list li:first-child { border-top: 1px solid var(--border); }

.article-list a {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 4px;
  text-decoration: none;
  color: var(--text-dark);
  transition: color 0.15s;
}
.article-list a:hover { color: var(--purple-mid); }

.article-list .article-title {
  font-size: 15px;
  font-weight: 500;
}
.article-list .chevron {
  color: var(--text-light);
  font-size: 18px;
  flex-shrink: 0;
  margin-left: 12px;
}

/* --- ARTICLE PAGE --- */
.article-header {
  margin-bottom: 36px;
}
.article-header h1 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--text-dark);
  margin-bottom: 8px;
  line-height: 1.3;
}
.article-header .subtitle {
  font-size: 16px;
  color: var(--text-secondary);
  margin-bottom: 16px;
  line-height: 1.5;
}
.article-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13px;
  color: var(--text-light);
}
.article-meta .avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: var(--sage);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 700;
  color: var(--purple-deep);
}

.article-body {
  font-size: 15px;
  line-height: 1.75;
  color: var(--text-dark);
}

.article-body h2 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 21px;
  font-weight: 700;
  margin: 36px 0 16px;
  color: var(--text-dark);
  padding-bottom: 8px;
  border-bottom: 2px solid var(--purple-pale);
}

.article-body h3 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 17px;
  font-weight: 600;
  margin: 28px 0 12px;
  color: var(--text-dark);
}

.article-body p { margin-bottom: 16px; }

.article-body ul, .article-body ol {
  margin: 12px 0 16px 24px;
}
.article-body li { margin-bottom: 8px; }

.article-body img {
  max-width: 100%;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  margin: 20px 0;
  box-shadow: var(--shadow-sm);
}

.article-body strong { font-weight: 700; }

.article-body code {
  background: var(--purple-pale);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 13px;
  font-family: 'SF Mono', 'Fira Code', monospace;
  color: var(--purple-deep);
}

.info-box {
  background: #EDE7F6;
  border-left: 4px solid var(--purple-mid);
  padding: 16px 20px;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  margin: 20px 0;
  font-size: 14px;
}
.info-box.tip { background: #E8F5E9; border-left-color: var(--sage); }
.info-box.warning { background: #FFF8E1; border-left-color: var(--amber); }
.info-box.important { background: #FCE4EC; border-left-color: var(--pink); }

.info-box strong {
  display: block;
  margin-bottom: 4px;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.ref-table {
  width: 100%;
  border-collapse: collapse;
  margin: 16px 0 24px;
  font-size: 14px;
}
.ref-table th {
  background: #F5F2ED;
  text-align: left;
  padding: 10px 14px;
  font-weight: 600;
  font-size: 13px;
  border-bottom: 2px solid var(--border);
}
.ref-table td {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  vertical-align: top;
}
.ref-table tr:hover td { background: var(--cream); }

.status-badge {
  display: inline-block;
  padding: 2px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}
.status-badge.green { background: #E8F5E9; color: #2E7D32; }
.status-badge.amber { background: #FFF8E1; color: #F57F17; }
.status-badge.blue { background: #E3F2FD; color: #1565C0; }
.status-badge.red { background: #FCE4EC; color: #C62828; }
.status-badge.gray { background: #F5F5F5; color: #616161; }
.status-badge.purple { background: #EDE7F6; color: #4527A0; }

/* --- SEARCH RESULTS --- */
.search-results {
  margin-top: 8px;
}
.search-results h2 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 20px;
  color: var(--text-dark);
}
.search-result-item {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 20px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: box-shadow 0.2s;
}
.search-result-item:hover { box-shadow: var(--shadow-md); }
.search-result-item h4 {
  font-size: 15px;
  font-weight: 600;
  color: var(--purple-deep);
  margin-bottom: 4px;
}
.search-result-item .collection-name {
  font-size: 12px;
  color: var(--text-light);
  margin-bottom: 8px;
}
.search-result-item p {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.5;
}

/* --- FOOTER --- */
.footer {
  background: var(--purple-deep);
  padding: 32px 40px;
  text-align: center;
}
.footer-content {
  max-width: 960px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.footer-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  color: rgba(255,255,255,0.7);
  font-size: 14px;
}
.footer-logo svg { height: 22px; }
.footer-links {
  display: flex;
  gap: 24px;
}
.footer-links a {
  color: rgba(255,255,255,0.6);
  text-decoration: none;
  font-size: 13px;
  transition: color 0.2s;
}
.footer-links a:hover { color: rgba(255,255,255,0.9); }

/* --- BACK TO TOP --- */
.back-to-top {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--purple-mid);
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  margin-top: 40px;
  cursor: pointer;
}
.back-to-top:hover { text-decoration: underline; }

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
  .header-top { padding: 12px 20px; }
  .header-content { padding: 32px 20px 40px; }
  .header-content h1 { font-size: 24px; }
  .main { padding: 24px 16px 60px; }
  .collections-grid { grid-template-columns: 1fr; }
  .footer-content { flex-direction: column; gap: 16px; }
  .collection-header { flex-direction: column; align-items: center; text-align: center; }
  .header-nav { display: none; }
  .ref-table { font-size: 12px; }
  .ref-table th, .ref-table td { padding: 8px 10px; }
}

/* --- TRANSITIONS --- */
.view-transition {
  animation: fadeIn 0.25s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* --- PRINT --- */
@media print {
  .header, .footer, .search-box, .back-to-top { display: none; }
  .main { max-width: 100%; padding: 20px; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header" id="site-header">
  <div class="header-decor"></div>
  <div class="header-top">
    <a href="#" class="header-logo" onclick="navigateTo('home'); return false;">
      <svg viewBox="0 0 160 28" fill="none" xmlns="http://www.w3.org/2000/svg">
        <text x="0" y="22" font-family="Space Grotesk, sans-serif" font-size="20" font-weight="700" fill="white">Agency Portal</text>
      </svg>
    </a>
    <nav class="header-nav">
      <a href="https://help.talkpush.com" target="_blank">Talkpush Help</a>
      <a href="index.html">Full Documentation</a>
    </nav>
  </div>
  <div class="header-content">
    <h1 id="header-title">How can we help?</h1>
    <div class="search-box">
      <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="search-input" placeholder="Search for articles..." oninput="handleSearch(this.value)" />
    </div>
  </div>
</header>

<!-- MAIN CONTENT -->
<main class="main" id="app">
  <!-- Rendered by JavaScript -->
</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">
      <svg viewBox="0 0 140 22" fill="none"><text x="0" y="18" font-family="Space Grotesk, sans-serif" font-size="16" font-weight="600" fill="rgba(255,255,255,0.7)">Agency Portal</text></svg>
      <span>&middot; Powered by Talkpush</span>
    </div>
    <div class="footer-links">
      <a href="https://www.talkpush.com" target="_blank">Website</a>
      <a href="https://www.talkpush.com/about-us" target="_blank">About Us</a>
      <a href="https://help.talkpush.com" target="_blank">Help Center</a>
    </div>
  </div>
</footer>

<!-- DATA & APPLICATION -->
<script>
// --- HELP CENTER DATA ---
const COLLECTIONS = [
  /* ================================================================
     1. GETTING STARTED
     ================================================================ */
  {
    id: 'getting-started',
    title: 'Getting Started',
    description: 'Learn the basics of the Agency Portal, how to activate your account, sign in, and navigate the interface.',
    icon: '\u{1F680}',
    iconBg: '#EDE7F6',
    articleCount: 4,
    articles: [
      {
        id: 'introduction',
        title: 'Introduction to the Agency Portal',
        subtitle: 'What is the Agency Portal and how it connects agencies with your recruitment workflow.',
        body: `
          <h2>What is the Agency Portal?</h2>
          <p>The Talkpush Agency Portal is a web application that enables organizations to manage their relationships with external staffing and recruitment agencies. It provides a centralized platform where agencies submit candidate referrals, internal teams track and review submissions, and all data syncs automatically with the Talkpush CRM.</p>

          <h2>Who is it for?</h2>
          <table class="ref-table">
            <tr><th>Audience</th><th>What They Do</th></tr>
            <tr><td><strong>Talkpush Owners</strong></td><td>Full system administrators who manage the entire platform across multiple companies</td></tr>
            <tr><td><strong>Company Admins</strong></td><td>Internal recruitment managers at a specific company who oversee all agencies, campaigns, and candidates</td></tr>
            <tr><td><strong>Agency Admins</strong></td><td>Agency managers who manage their team of recruiters and view all their agency's candidates</td></tr>
            <tr><td><strong>Agency Users</strong></td><td>Individual agency recruiters who submit and track their own candidates</td></tr>
          </table>

          <h2>Key Capabilities</h2>
          <ul>
            <li><strong>Candidate referral submission</strong> with resume upload</li>
            <li><strong>AI-powered resume parsing</strong> that automatically summarizes resumes</li>
            <li><strong>Intelligent duplicate detection</strong> with configurable ownership windows</li>
            <li><strong>Real-time sync</strong> with the Talkpush CRM</li>
            <li><strong>Multi-country, multi-company support</strong> for global operations</li>
            <li><strong>Role-based access control</strong> with 4 levels of permissions</li>
            <li><strong>Analytics dashboard</strong> with period-based metrics</li>
            <li><strong>Comments</strong> synced bidirectionally with the Talkpush CRM</li>
          </ul>
        `
      },
      {
        id: 'account-activation',
        title: 'Account Activation & First Login',
        subtitle: 'How to activate your account from the invitation email and log in for the first time.',
        body: `
          <h2>Receiving Your Invitation</h2>
          <p>When an administrator creates your account, you will receive an <strong>activation email</strong> with a unique link. This link is valid for <strong>7 days</strong>.</p>

          <h2>Activation Steps</h2>
          <ol>
            <li>Open the activation email and click the link</li>
            <li>You will be taken to the password setup page</li>
            <li>Enter and confirm a new password</li>
            <li>Click <strong>"Activate Account"</strong></li>
            <li>You will be redirected to the login page</li>
          </ol>

          <div class="info-box warning">
            <strong>Important</strong>
            If your activation link has expired (after 7 days), contact your administrator to resend the invitation.
          </div>

          <h2>Logging In</h2>
          <ol>
            <li>Navigate to your company's portal URL</li>
            <li>Enter your <strong>email address</strong> and <strong>password</strong></li>
            <li>Click <strong>"Sign In"</strong></li>
          </ol>

          <h2>Forgot Your Password?</h2>
          <ol>
            <li>Click <strong>"Forgot Password?"</strong> on the login page</li>
            <li>Enter your registered email address</li>
            <li>Check your email for a reset link (valid for <strong>1 hour</strong>)</li>
            <li>Click the link and set a new password</li>
          </ol>
        `
      },
      {
        id: 'navigation',
        title: 'Navigating the Interface',
        subtitle: 'Understand the sidebar, top bar, and how to move around the portal.',
        body: `
          <h2>Sidebar Navigation</h2>
          <p>The sidebar on the left side of the screen is your primary navigation. The menu items visible to you depend on your role:</p>
          <table class="ref-table">
            <tr><th>Menu Item</th><th>Available To</th><th>Description</th></tr>
            <tr><td><strong>My Candidates</strong></td><td>Everyone</td><td>Your personally submitted candidates</td></tr>
            <tr><td><strong>Agency Pool</strong></td><td>Agency Admin, Company Admin, Owner</td><td>All candidates across agencies</td></tr>
            <tr><td><strong>Users</strong></td><td>Agency Admin and above</td><td>User account management</td></tr>
            <tr><td><strong>Agencies</strong></td><td>Company Admin, Owner</td><td>Agency management</td></tr>
            <tr><td><strong>Metrics</strong></td><td>Company Admin, Owner</td><td>Analytics dashboard</td></tr>
            <tr><td><strong>Campaigns</strong></td><td>Company Admin, Owner</td><td>Campaign management</td></tr>
            <tr><td><strong>Folders</strong></td><td>Company Admin, Owner</td><td>Pipeline stage mapping</td></tr>
            <tr><td><strong>Countries</strong></td><td>Company Admin, Owner</td><td>CRM instance configuration</td></tr>
            <tr><td><strong>Company</strong></td><td>Owner only</td><td>Company/tenant management</td></tr>
            <tr><td><strong>Import Data</strong></td><td>Owner only</td><td>Data import and cleanup tools</td></tr>
          </table>

          <h2>Top Bar</h2>
          <p>The top bar shows the page title on the left and your user menu on the right. Click your name to access <strong>Edit Profile</strong> and <strong>Log Out</strong>.</p>

          <h2>Company Context (Talkpush Owners Only)</h2>
          <p>When a Talkpush Owner selects a specific company, a context bar appears at the top showing the selected company name. All data is filtered to that company. Click the <strong>X</strong> button to clear the selection and return to the global view.</p>

          <h2>Toast Notifications</h2>
          <p>Success and error messages appear as toast notifications in the top-right corner of the screen and auto-dismiss after a few seconds.</p>
        `
      },
      {
        id: 'roles-permissions',
        title: 'User Roles & Permissions',
        subtitle: 'Understand the four access levels and what each role can do.',
        body: `
          <h2>Role Hierarchy</h2>
          <p>The Agency Portal uses a <strong>4-tier Role-Based Access Control (RBAC)</strong> system. Each user is assigned exactly one role:</p>
          <ul>
            <li><strong>Talkpush Owner</strong> (Level 1) &mdash; highest access, manages everything across all companies</li>
            <li><strong>Company Admin</strong> (Level 4) &mdash; manages everything within their assigned company</li>
            <li><strong>Agency Admin</strong> (Level 2) &mdash; manages their agency's users and sees all agency candidates</li>
            <li><strong>Agency User</strong> (Level 3) &mdash; most restricted, sees only their own candidates</li>
          </ul>

          <h2>Permission Matrix</h2>
          <table class="ref-table">
            <tr><th>Permission</th><th>Talkpush Owner</th><th>Company Admin</th><th>Agency Admin</th><th>Agency User</th></tr>
            <tr><td>Create/Edit campaigns</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr>
            <tr><td>Create/Edit agencies</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr>
            <tr><td>Manage all users</td><td>Yes</td><td>Company scope</td><td>Agency scope</td><td>No</td></tr>
            <tr><td>Manage countries/CRM</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr>
            <tr><td>Manage folders</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr>
            <tr><td>Manage companies</td><td>Yes</td><td>No</td><td>No</td><td>No</td></tr>
            <tr><td>Import data</td><td>Yes</td><td>No</td><td>No</td><td>No</td></tr>
            <tr><td>View all candidates</td><td>Yes</td><td>Yes</td><td>Agency only</td><td>Own only</td></tr>
            <tr><td>Upload candidates</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr>
            <tr><td>View metrics</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr>
          </table>

          <div class="info-box">
            <strong>Note</strong>
            The system prevents role escalation: you cannot assign a role higher than your own. For example, a Company Admin cannot create a Talkpush Owner.
          </div>
        `
      }
    ]
  },

  /* ================================================================
     2. SUBMITTING CANDIDATES
     ================================================================ */
  {
    id: 'submitting-candidates',
    title: 'Submitting Candidates',
    description: 'Learn how to submit new candidates, upload resumes, and understand duplicate detection tags.',
    icon: '\u{1F4E4}',
    iconBg: '#E8F5E9',
    articleCount: 4,
    articles: [
      {
        id: 'add-candidate',
        title: 'How to Submit a New Candidate',
        subtitle: 'Step-by-step guide to adding a candidate referral with resume.',
        body: `
          <h2>Opening the Submission Form</h2>
          <p>From the <strong>My Candidates</strong> page, click the <strong>"Add Candidate"</strong> button in the top-right corner. This opens a slide-over panel with the submission form.</p>

          <h2>Required Information</h2>
          <table class="ref-table">
            <tr><th>Field</th><th>Required</th><th>Description</th></tr>
            <tr><td>First Name</td><td>Yes</td><td>Candidate's first name</td></tr>
            <tr><td>Last Name</td><td>Yes</td><td>Candidate's last name</td></tr>
            <tr><td>Email</td><td>Yes</td><td>Valid email address</td></tr>
            <tr><td>Phone</td><td>Yes</td><td>Phone number with country code</td></tr>
            <tr><td>Campaign</td><td>Yes</td><td>Select from your assigned campaigns</td></tr>
            <tr><td>Resume</td><td>Yes</td><td>PDF or DOCX file</td></tr>
          </table>

          <h2>Submission Steps</h2>
          <ol>
            <li>Fill in the candidate's name, email, and phone number</li>
            <li>Select a country code from the dropdown for the phone number</li>
            <li>Choose the <strong>campaign</strong> you are submitting the candidate to</li>
            <li>Upload a <strong>resume file</strong> (PDF or DOCX format)</li>
            <li>Click <strong>"Submit"</strong></li>
          </ol>

          <h2>What Happens After Submission</h2>
          <p>After you submit a candidate, the system automatically:</p>
          <ol>
            <li><strong>Checks for duplicates</strong> against existing candidates in the same campaign</li>
            <li><strong>Creates the candidate record</strong> in the portal database</li>
            <li><strong>Sends the candidate to the Talkpush CRM</strong> via API</li>
            <li><strong>Uploads the resume</strong> to the CRM as a document</li>
            <li><strong>Runs AI resume processing</strong> to generate a summary</li>
            <li><strong>Assigns a tag</strong> (Added, Previously Submitted, or Duplicate)</li>
          </ol>

          <div class="info-box tip">
            <strong>Tip</strong>
            You can only submit candidates to campaigns that have been assigned to your agency. If you don't see a campaign, ask your administrator to assign it.
          </div>
        `
      },
      {
        id: 'duplicate-detection',
        title: 'Duplicate Detection & Ownership Tags',
        subtitle: 'How the system identifies duplicates and assigns ownership tags.',
        body: `
          <h2>How Duplicate Detection Works</h2>
          <p>When you submit a candidate, the system checks whether a candidate with the same <strong>email address</strong> has already been submitted to the same campaign. The result determines which <strong>tag</strong> is assigned.</p>

          <h2>Tag Types</h2>
          <table class="ref-table">
            <tr><th>Tag</th><th>Color</th><th>Meaning</th></tr>
            <tr><td><span class="status-badge green">Added</span></td><td>Green</td><td>Brand-new candidate. No previous submission exists for this email in this campaign.</td></tr>
            <tr><td><span class="status-badge amber">Previously Submitted</span></td><td>Amber</td><td>Your agency (or you) already submitted this candidate to this campaign before.</td></tr>
            <tr><td><span class="status-badge purple">Duplicate</span></td><td>Purple</td><td>Another agency or a direct applicant already owns this candidate in this campaign.</td></tr>
          </table>

          <h2>Ownership Window</h2>
          <p>Each country has a configurable <strong>ownership window</strong> (default: 24 months). This defines how long a candidate "belongs" to the first agency that submitted them. During this window, any subsequent submission of the same candidate by a different agency will be tagged as <strong>Duplicate</strong>.</p>

          <div class="info-box">
            <strong>Note</strong>
            The ownership window is configured per country by administrators. Ask your Company Admin if you need to know the current window for your region.
          </div>

          <h2>What You Should Know</h2>
          <ul>
            <li><strong>Added</strong> candidates are new &mdash; your submission counts as the first referral</li>
            <li><strong>Previously Submitted</strong> means your agency already has this candidate on file, so no new CRM record is created</li>
            <li><strong>Duplicate</strong> means another source owns this candidate &mdash; the candidate is still recorded in your list but the CRM record belongs to the original source</li>
          </ul>
        `
      },
      {
        id: 'resume-ai',
        title: 'AI Resume Processing',
        subtitle: 'How the system automatically parses and summarizes uploaded resumes.',
        body: `
          <h2>Automatic Resume Processing</h2>
          <p>When you upload a resume during candidate submission, the system uses <strong>AI (GPT-4o-mini)</strong> to automatically process the document. This happens in the background immediately after the candidate is created.</p>

          <h2>What the AI Extracts</h2>
          <p>The AI reads the resume content and generates a <strong>structured summary</strong> that includes:</p>
          <ul>
            <li><strong>Professional Summary</strong> &mdash; A brief overview of the candidate's background</li>
            <li><strong>Key Skills</strong> &mdash; Technical and soft skills identified in the resume</li>
            <li><strong>Work Experience</strong> &mdash; Summarized employment history</li>
            <li><strong>Education</strong> &mdash; Degrees and certifications</li>
          </ul>

          <h2>Where to See the AI Summary</h2>
          <p>The AI summary appears on the <strong>Candidate Detail</strong> page, in the <strong>"AI Summary"</strong> section. It is also sent to the Talkpush CRM as a custom attribute on the candidate record.</p>

          <div class="info-box tip">
            <strong>Tip</strong>
            AI summaries are generated automatically &mdash; no action is required from you. They typically appear within a few seconds of submission.
          </div>

          <h2>Supported File Formats</h2>
          <ul>
            <li><strong>PDF</strong> (.pdf) &mdash; Most common and recommended</li>
            <li><strong>DOCX</strong> (.docx) &mdash; Microsoft Word documents</li>
          </ul>
        `
      },
      {
        id: 'campaign-selection',
        title: 'Understanding Campaign Assignments',
        subtitle: 'How campaigns are assigned to agencies and why you may not see certain campaigns.',
        body: `
          <h2>What Are Campaigns?</h2>
          <p>Campaigns represent active recruitment positions or job openings. Each campaign is linked to a specific <strong>country</strong> (and therefore a specific Talkpush CRM instance) and has a <strong>campaign ID</strong> that maps to the corresponding campaign in the CRM.</p>

          <h2>Agency-Campaign Assignments</h2>
          <p>Not all campaigns are visible to all agencies. A Company Admin or Talkpush Owner assigns specific campaigns to each agency. You will only see the campaigns that have been <strong>assigned and enabled</strong> for your agency.</p>

          <h2>Why Can't I See a Campaign?</h2>
          <p>If you don't see a campaign you expect, it may be because:</p>
          <ul>
            <li>The campaign has not been <strong>assigned</strong> to your agency</li>
            <li>The campaign assignment has been <strong>disabled</strong></li>
            <li>The campaign belongs to a different <strong>country</strong> than your agency</li>
            <li>The campaign has been <strong>deactivated</strong> by an administrator</li>
          </ul>

          <div class="info-box">
            <strong>Note</strong>
            Contact your Company Admin if you need access to a campaign that isn't currently showing in your list.
          </div>
        `
      }
    ]
  },

  /* ================================================================
     3. MY CANDIDATES
     ================================================================ */
  {
    id: 'my-candidates',
    title: 'My Candidates',
    description: 'Your primary workspace for viewing, searching, and managing your submitted candidates.',
    icon: '\u{1F465}',
    iconBg: '#E3F2FD',
    articleCount: 3,
    articles: [
      {
        id: 'candidate-list',
        title: 'The Candidate List View',
        subtitle: 'Navigate your candidate table, use filters, and understand the status chips.',
        body: `
          <h2>Overview</h2>
          <p>The <strong>My Candidates</strong> page is your primary workspace. It shows all candidates that <strong>you personally submitted</strong>. Agency Admins can see all candidates from their agency, and Company Admins/Owners can see all candidates across the platform.</p>

          <h2>Header Statistics</h2>
          <p>Three colored chips at the top of the page show your submission statistics:</p>
          <ul>
            <li><span class="status-badge green">Added</span> &mdash; Number of new candidates successfully added</li>
            <li><span class="status-badge amber">Previously Submitted</span> &mdash; Candidates your agency already had on file</li>
            <li><span class="status-badge purple">Duplicate</span> &mdash; Candidates owned by another source</li>
          </ul>

          <h2>Filters</h2>
          <ul>
            <li><strong>Campaign</strong> dropdown &mdash; Filter by a specific campaign</li>
            <li><strong>Search</strong> &mdash; Search by candidate name, email, or phone number</li>
            <li><strong>Status/Tag</strong> filter &mdash; Filter by tag type (Added, Previously Submitted, Duplicate)</li>
          </ul>

          <h2>Table Columns</h2>
          <table class="ref-table">
            <tr><th>Column</th><th>Description</th></tr>
            <tr><td>Name</td><td>Candidate's full name (clickable link to detail page)</td></tr>
            <tr><td>Email</td><td>Candidate's email address</td></tr>
            <tr><td>Phone</td><td>Phone number with country code</td></tr>
            <tr><td>Campaign</td><td>The campaign the candidate was submitted to</td></tr>
            <tr><td>Country</td><td>Country of the campaign (visible for admins)</td></tr>
            <tr><td>Stage</td><td>Current pipeline stage from the Talkpush CRM</td></tr>
            <tr><td>Tag</td><td>Color-coded status tag (Added, Previously Submitted, Duplicate)</td></tr>
            <tr><td>Date</td><td>Submission date</td></tr>
          </table>

          <div class="info-box">
            <strong>Note</strong>
            The "Stage" column visibility is controlled per country by administrators. Some countries may not show pipeline stages.
          </div>
        `
      },
      {
        id: 'candidate-detail',
        title: 'Candidate Detail Page',
        subtitle: 'View full candidate information, AI summaries, CRM stage, comments, and more.',
        body: `
          <h2>Accessing Candidate Details</h2>
          <p>Click on any candidate's <strong>name</strong> in the list to open their detail page. This page shows all information about the candidate in one place.</p>

          <h2>Information Sections</h2>
          <h3>Candidate Info Card</h3>
          <p>Shows the candidate's name, email, phone, campaign, tag, and submission date. For admins, it also shows the submitting agency and user.</p>

          <h3>CRM Status</h3>
          <p>If the candidate has been synced with the Talkpush CRM, you'll see:</p>
          <ul>
            <li><strong>Current folder/stage</strong> &mdash; Where the candidate is in the recruitment pipeline</li>
            <li><strong>Rejection notes</strong> &mdash; If the candidate was rejected, the reason is displayed</li>
            <li><strong>Talkpush Lead ID</strong> &mdash; The unique identifier in the CRM</li>
          </ul>

          <h3>AI Resume Summary</h3>
          <p>The AI-generated summary of the candidate's resume, including professional summary, key skills, experience, and education.</p>

          <h3>Comments</h3>
          <p>A chronological list of comments and notes about the candidate. Comments sync bidirectionally with the Talkpush CRM &mdash; comments added here appear in the CRM, and comments from the CRM appear here.</p>

          <h2>Available Actions</h2>
          <ul>
            <li><strong>Add a comment</strong> &mdash; Post a note that syncs to the CRM</li>
            <li><strong>Withdraw candidate</strong> &mdash; Remove the candidate from the recruitment process (cannot be undone)</li>
            <li><strong>Edit candidate details</strong> &mdash; Update name, email, or phone (admin roles only)</li>
          </ul>
        `
      },
      {
        id: 'withdraw-candidate',
        title: 'Withdrawing a Candidate',
        subtitle: 'How to withdraw a candidate and what happens to their CRM record.',
        body: `
          <h2>When to Withdraw</h2>
          <p>You may need to withdraw a candidate if they are no longer available, have declined the position, or were submitted in error.</p>

          <h2>How to Withdraw</h2>
          <ol>
            <li>Open the candidate's <strong>detail page</strong></li>
            <li>Click the <strong>"Withdraw"</strong> button</li>
            <li>Confirm the withdrawal in the dialog</li>
          </ol>

          <div class="info-box warning">
            <strong>Warning</strong>
            Withdrawal is permanent and cannot be undone. The candidate's status will be updated in both the portal and the Talkpush CRM.
          </div>

          <h2>What Happens After Withdrawal</h2>
          <ul>
            <li>The candidate's record is marked as <strong>withdrawn</strong> in the portal</li>
            <li>The Talkpush CRM is notified of the withdrawal</li>
            <li>The candidate remains in your list for record-keeping but is no longer active</li>
          </ul>
        `
      }
    ]
  },

  /* ================================================================
     4. AGENCY POOL
     ================================================================ */
  {
    id: 'agency-pool',
    title: 'Agency Pool',
    description: 'View all candidates across agencies, with advanced filtering and cross-agency visibility.',
    icon: '\u{1F30A}',
    iconBg: '#E0F7FA',
    articleCount: 2,
    articles: [
      {
        id: 'agency-pool-overview',
        title: 'Using the Agency Pool',
        subtitle: 'How the Agency Pool works and who can access it.',
        body: `
          <h2>What is the Agency Pool?</h2>
          <p>The Agency Pool provides a <strong>cross-agency view</strong> of all submitted candidates. Unlike "My Candidates" which shows only your personal submissions, the Agency Pool shows candidates from <strong>all agencies</strong> (based on your permission level).</p>

          <h2>Who Can Access the Agency Pool?</h2>
          <table class="ref-table">
            <tr><th>Role</th><th>What They See</th></tr>
            <tr><td><strong>Agency Admin</strong></td><td>All candidates submitted by anyone in their agency</td></tr>
            <tr><td><strong>Company Admin</strong></td><td>All candidates across all agencies in their company</td></tr>
            <tr><td><strong>Talkpush Owner</strong></td><td>All candidates across all agencies and companies</td></tr>
          </table>

          <div class="info-box">
            <strong>Note</strong>
            Agency Users (the most restricted role) do not have access to the Agency Pool. They can only see their own candidates in "My Candidates."
          </div>

          <h2>Features</h2>
          <p>The Agency Pool includes the same filtering, search, and pagination capabilities as the My Candidates page, plus an additional <strong>Agency</strong> filter column that shows which agency submitted each candidate.</p>
        `
      },
      {
        id: 'pool-filters',
        title: 'Filtering & Searching in the Agency Pool',
        subtitle: 'Use campaign, agency, tag, and search filters to find specific candidates.',
        body: `
          <h2>Available Filters</h2>
          <ul>
            <li><strong>Campaign</strong> &mdash; Filter by specific recruitment campaign</li>
            <li><strong>Agency</strong> &mdash; Filter by submitting agency (Company Admin/Owner only)</li>
            <li><strong>Tag</strong> &mdash; Filter by status tag (Added, Previously Submitted, Duplicate)</li>
            <li><strong>Search</strong> &mdash; Free-text search by candidate name, email, or phone</li>
          </ul>

          <h2>Using Filters Together</h2>
          <p>Filters can be combined. For example, you can filter to see only <strong>"Added"</strong> candidates in a specific campaign from a specific agency. This is useful for reviewing new submissions or identifying duplicates across agencies.</p>

          <h2>Exporting Data</h2>
          <p>If you need to export filtered candidate data, use the <strong>Reports</strong> section instead, which provides Excel export capabilities with customizable date ranges.</p>
        `
      }
    ]
  },

  /* ================================================================
     5. USER MANAGEMENT
     ================================================================ */
  {
    id: 'user-management',
    title: 'User Management',
    description: 'Create, edit, enable/disable user accounts and manage team access.',
    icon: '\u{1F464}',
    iconBg: '#FFF3E0',
    articleCount: 3,
    articles: [
      {
        id: 'creating-users',
        title: 'Creating & Inviting Users',
        subtitle: 'How to create new user accounts and send activation invitations.',
        body: `
          <h2>Who Can Create Users?</h2>
          <ul>
            <li><strong>Talkpush Owners</strong> can create any user in any company</li>
            <li><strong>Company Admins</strong> can create users within their company (Agency Admins and Agency Users)</li>
            <li><strong>Agency Admins</strong> can create Agency Users within their own agency</li>
          </ul>

          <h2>Creating a New User</h2>
          <ol>
            <li>Go to <strong>Users</strong> in the sidebar</li>
            <li>Click <strong>"Add User"</strong></li>
            <li>Fill in the required fields:
              <ul>
                <li><strong>First Name</strong> and <strong>Last Name</strong></li>
                <li><strong>Email</strong> (must be unique)</li>
                <li><strong>Role</strong> (cannot be higher than your own role)</li>
                <li><strong>Agency</strong> (required for Agency Admin and Agency User roles)</li>
              </ul>
            </li>
            <li>Click <strong>"Create"</strong></li>
          </ol>

          <p>The system will automatically send an <strong>activation email</strong> to the new user. They have 7 days to activate their account.</p>

          <h2>Resending Invitations</h2>
          <p>If a user's activation link has expired, you can resend it from the user list by clicking the <strong>"Resend Invite"</strong> option on their row.</p>
        `
      },
      {
        id: 'enable-disable-users',
        title: 'Enabling & Disabling Users',
        subtitle: 'How to activate or deactivate user accounts without deleting them.',
        body: `
          <h2>Enabling and Disabling</h2>
          <p>Instead of deleting user accounts, the portal uses an <strong>enable/disable</strong> system. Disabled users cannot log in but their data (submitted candidates, comments) is preserved.</p>

          <h2>How to Toggle a User</h2>
          <ol>
            <li>Go to <strong>Users</strong> in the sidebar</li>
            <li>Find the user in the list</li>
            <li>Click the <strong>toggle switch</strong> in the "Enabled" column</li>
            <li>Confirm the action</li>
          </ol>

          <div class="info-box warning">
            <strong>Important &mdash; Cascade Effect</strong>
            Disabling operates with a cascade system. If you disable an <strong>agency</strong>, all users in that agency are automatically disabled. Similarly, disabling a <strong>country</strong> disables all agencies (and their users) in that country.
          </div>

          <h2>Cascade Hierarchy</h2>
          <p>The cascade flows from top to bottom:</p>
          <ul>
            <li><strong>Country disabled</strong> &rarr; All agencies in that country disabled &rarr; All users in those agencies disabled</li>
            <li><strong>Agency disabled</strong> &rarr; All users in that agency disabled</li>
            <li><strong>User disabled</strong> &rarr; Only that specific user is affected</li>
          </ul>
        `
      },
      {
        id: 'editing-users',
        title: 'Editing User Profiles',
        subtitle: 'How to update user information, change roles, and reassign agencies.',
        body: `
          <h2>What Can Be Edited</h2>
          <ul>
            <li><strong>Name</strong> (first and last)</li>
            <li><strong>Email</strong> (must remain unique)</li>
            <li><strong>Role</strong> (cannot assign higher than your own)</li>
            <li><strong>Agency assignment</strong> (for agency-level roles)</li>
          </ul>

          <h2>How to Edit a User</h2>
          <ol>
            <li>Go to <strong>Users</strong> in the sidebar</li>
            <li>Click the <strong>edit icon</strong> on the user's row</li>
            <li>Make your changes in the edit form</li>
            <li>Click <strong>"Save"</strong></li>
          </ol>

          <div class="info-box">
            <strong>Note</strong>
            Passwords cannot be changed by administrators. Users must use the "Forgot Password" flow to reset their own passwords.
          </div>
        `
      }
    ]
  },

  /* ================================================================
     6. AGENCY MANAGEMENT
     ================================================================ */
  {
    id: 'agency-management',
    title: 'Agency Management',
    description: 'Create and configure staffing agencies, assign campaigns, and manage the agency lifecycle.',
    icon: '\u{1F3E2}',
    iconBg: '#FCE4EC',
    articleCount: 3,
    articles: [
      {
        id: 'creating-agencies',
        title: 'Creating an Agency',
        subtitle: 'How to set up a new staffing agency in the portal.',
        body: `
          <h2>Who Can Create Agencies?</h2>
          <p>Only <strong>Talkpush Owners</strong> and <strong>Company Admins</strong> can create agencies.</p>

          <h2>Steps to Create an Agency</h2>
          <ol>
            <li>Go to <strong>Agencies</strong> in the sidebar</li>
            <li>Click <strong>"Add Agency"</strong></li>
            <li>Fill in the agency details:
              <ul>
                <li><strong>Agency Name</strong> (required)</li>
                <li><strong>Country</strong> (required &mdash; links the agency to a CRM instance)</li>
                <li><strong>Logo</strong> (optional &mdash; upload a logo image)</li>
              </ul>
            </li>
            <li>Click <strong>"Create"</strong></li>
          </ol>

          <h2>After Creation</h2>
          <p>Once an agency is created, you need to:</p>
          <ol>
            <li><strong>Assign campaigns</strong> to the agency (so they can submit candidates)</li>
            <li><strong>Create users</strong> for the agency (Agency Admin and Agency Users)</li>
          </ol>
        `
      },
      {
        id: 'agency-campaigns',
        title: 'Assigning Campaigns to Agencies',
        subtitle: 'Control which campaigns each agency can submit candidates to.',
        body: `
          <h2>How Campaign Assignment Works</h2>
          <p>Agencies can only submit candidates to campaigns that have been explicitly <strong>assigned</strong> to them. This allows you to control which agencies participate in which recruitment campaigns.</p>

          <h2>Assigning Campaigns</h2>
          <ol>
            <li>Go to <strong>Campaigns</strong> in the sidebar</li>
            <li>Find the campaign you want to assign</li>
            <li>Click the <strong>agency assignment</strong> button or open the campaign detail</li>
            <li>Toggle the agencies that should have access</li>
          </ol>

          <h2>Enabling/Disabling Assignments</h2>
          <p>Each agency-campaign assignment can be independently <strong>enabled or disabled</strong>. Disabling an assignment hides the campaign from the agency's dropdown when submitting candidates, but preserves any existing submissions.</p>

          <div class="info-box tip">
            <strong>Tip</strong>
            Use campaign assignments strategically. For example, you might assign a specialized technical recruitment campaign only to agencies with relevant expertise.
          </div>
        `
      },
      {
        id: 'agency-enable-disable',
        title: 'Enabling & Disabling Agencies',
        subtitle: 'How to activate or deactivate an entire agency and its users.',
        body: `
          <h2>Agency Status Toggle</h2>
          <p>Like user accounts, agencies can be <strong>enabled or disabled</strong>. Disabling an agency prevents all of its users from logging in and submitting candidates.</p>

          <h2>How to Toggle</h2>
          <ol>
            <li>Go to <strong>Agencies</strong> in the sidebar</li>
            <li>Find the agency in the list</li>
            <li>Click the <strong>toggle switch</strong> in the status column</li>
          </ol>

          <div class="info-box warning">
            <strong>Cascade Effect</strong>
            When you disable an agency, <strong>all users</strong> in that agency are automatically disabled. When you re-enable the agency, users are restored to their previous state.
          </div>

          <h2>Data Preservation</h2>
          <p>Disabling an agency does <strong>not</strong> delete any data. All candidates, comments, and history are preserved. The agency's users simply cannot log in until the agency is re-enabled.</p>
        `
      }
    ]
  },

  /* ================================================================
     7. CAMPAIGN MANAGEMENT
     ================================================================ */
  {
    id: 'campaign-management',
    title: 'Campaign Management',
    description: 'Create, edit, and manage recruitment campaigns that map to Talkpush CRM campaigns.',
    icon: '\u{1F3AF}',
    iconBg: '#F3E5F5',
    articleCount: 2,
    articles: [
      {
        id: 'creating-campaigns',
        title: 'Creating & Editing Campaigns',
        subtitle: 'Set up campaigns that map to your Talkpush CRM and assign them to agencies.',
        body: `
          <h2>What is a Campaign?</h2>
          <p>A campaign in the Agency Portal represents an active recruitment position. Each campaign maps to a <strong>campaign in the Talkpush CRM</strong> via its Campaign ID. When candidates are submitted to a portal campaign, they are automatically created in the corresponding CRM campaign.</p>

          <h2>Creating a Campaign</h2>
          <ol>
            <li>Go to <strong>Campaigns</strong> in the sidebar</li>
            <li>Click <strong>"Add Campaign"</strong></li>
            <li>Fill in the required fields:
              <ul>
                <li><strong>Campaign Name</strong> &mdash; A descriptive name</li>
                <li><strong>Campaign ID</strong> &mdash; The ID from the Talkpush CRM</li>
                <li><strong>Country</strong> &mdash; The country (CRM instance) this campaign belongs to</li>
              </ul>
            </li>
            <li>Click <strong>"Create"</strong></li>
          </ol>

          <div class="info-box">
            <strong>Note</strong>
            The Campaign ID must match exactly with the campaign ID in your Talkpush CRM. If the IDs don't match, candidate submissions will fail.
          </div>

          <h2>Editing Campaigns</h2>
          <p>Click the <strong>edit icon</strong> on any campaign row to update its name or other settings. The Campaign ID and Country cannot be changed after creation.</p>
        `
      },
      {
        id: 'campaign-status',
        title: 'Campaign Status & Lifecycle',
        subtitle: 'How campaigns are activated, deactivated, and managed over time.',
        body: `
          <h2>Active vs. Inactive Campaigns</h2>
          <p>Campaigns can be <strong>enabled</strong> or <strong>disabled</strong>. When a campaign is disabled:</p>
          <ul>
            <li>It no longer appears in the campaign dropdown when submitting candidates</li>
            <li>Existing candidates in that campaign remain visible and searchable</li>
            <li>The campaign's data is preserved for reporting purposes</li>
          </ul>

          <h2>Managing Campaign Lifecycle</h2>
          <p>A typical campaign lifecycle:</p>
          <ol>
            <li><strong>Create</strong> the campaign when a new position opens</li>
            <li><strong>Assign</strong> relevant agencies to the campaign</li>
            <li>Agencies <strong>submit candidates</strong> throughout the recruitment period</li>
            <li><strong>Disable</strong> the campaign when the position is filled or closed</li>
          </ol>

          <div class="info-box tip">
            <strong>Tip</strong>
            Don't delete campaigns &mdash; disable them instead. This preserves historical data and allows you to report on past campaigns.
          </div>
        `
      }
    ]
  },

  /* ================================================================
     8. COUNTRY & CRM CONFIGURATION
     ================================================================ */
  {
    id: 'country-config',
    title: 'Country & CRM Configuration',
    description: 'Set up countries, CRM instance connections, ownership windows, and folder mappings.',
    icon: '\u{1F30D}',
    iconBg: '#E8EAF6',
    articleCount: 3,
    articles: [
      {
        id: 'country-setup',
        title: 'Setting Up Countries',
        subtitle: 'Configure countries that map to your Talkpush CRM instances.',
        body: `
          <h2>What is a Country?</h2>
          <p>In the Agency Portal, a "Country" represents a <strong>Talkpush CRM instance</strong>. Each country has its own CRM connection, API credentials, and configuration settings. Companies that operate in multiple regions will have multiple countries configured.</p>

          <h2>Creating a Country</h2>
          <ol>
            <li>Go to <strong>Countries</strong> in the sidebar</li>
            <li>Click <strong>"Add Country"</strong></li>
            <li>Fill in the configuration:
              <ul>
                <li><strong>Country Name</strong> &mdash; e.g., "India", "Philippines"</li>
                <li><strong>Instance URL</strong> &mdash; The Talkpush CRM URL (e.g., <code>https://company-india.talkpush.com</code>)</li>
                <li><strong>API Key</strong> &mdash; Authentication key for CRM API calls</li>
                <li><strong>CRM Email</strong> &mdash; Manager email used for comment sync</li>
                <li><strong>Ownership Window</strong> &mdash; Number of months for duplicate ownership (default: 24)</li>
              </ul>
            </li>
            <li>Click <strong>"Create"</strong></li>
          </ol>

          <div class="info-box warning">
            <strong>Important</strong>
            The Instance URL and API Key must be correct for the CRM integration to work. Test the connection after setup.
          </div>
        `
      },
      {
        id: 'ownership-window',
        title: 'Configuring the Ownership Window',
        subtitle: 'Set how long a candidate belongs to the first submitting agency.',
        body: `
          <h2>What is the Ownership Window?</h2>
          <p>The ownership window defines the <strong>cooling period</strong> during which a candidate "belongs" to the first agency that submitted them. Any subsequent submission of the same candidate by a different agency will be tagged as <strong>Duplicate</strong> during this period.</p>

          <h2>Default Setting</h2>
          <p>The default ownership window is <strong>24 months</strong>. This can be configured independently for each country.</p>

          <h2>How to Change It</h2>
          <ol>
            <li>Go to <strong>Countries</strong> in the sidebar</li>
            <li>Click the <strong>edit icon</strong> on the country</li>
            <li>Update the <strong>"Ownership Window (Months)"</strong> field</li>
            <li>Click <strong>"Save"</strong></li>
          </ol>

          <h2>Practical Example</h2>
          <p>If the ownership window is set to 6 months: Agency A submits John Smith on January 1. If Agency B submits John Smith on May 1 (within 6 months), Agency B's submission is tagged as <strong>Duplicate</strong>. If Agency B submits John Smith on August 1 (after 6 months), it would be tagged as <strong>Added</strong> since the ownership has expired.</p>
        `
      },
      {
        id: 'folder-management',
        title: 'Folder Management (Pipeline Stages)',
        subtitle: 'Map Talkpush CRM pipeline stages to the portal for candidate tracking.',
        body: `
          <h2>What Are Folders?</h2>
          <p>Folders represent the <strong>pipeline stages</strong> in the Talkpush CRM. They allow you to track where each candidate is in the recruitment process (e.g., "Screening", "Interview", "Offer", "Hired").</p>

          <h2>How Folders Are Used</h2>
          <p>When viewing a candidate's detail page, the portal fetches the candidate's current folder/stage from the Talkpush CRM in real time. This gives agency recruiters visibility into where their candidates are in the process.</p>

          <h2>Managing Folders</h2>
          <ol>
            <li>Go to <strong>Folders</strong> in the sidebar</li>
            <li>Add folders that match your Talkpush CRM pipeline stages</li>
            <li>Each folder needs a <strong>Folder ID</strong> that maps to the CRM</li>
          </ol>

          <h2>Stage Visibility</h2>
          <p>The "Stage" column in the candidate list can be shown or hidden per country. This is controlled by the <strong>"View Stages"</strong> setting on each country. Talkpush Owners always see stages regardless of this setting.</p>
        `
      }
    ]
  },

  /* ================================================================
     9. METRICS & ANALYTICS
     ================================================================ */
  {
    id: 'metrics-analytics',
    title: 'Metrics & Analytics',
    description: 'Track submission volumes, agency performance, and candidate status breakdowns.',
    icon: '\u{1F4CA}',
    iconBg: '#E8F5E9',
    articleCount: 2,
    articles: [
      {
        id: 'metrics-dashboard',
        title: 'Using the Metrics Dashboard',
        subtitle: 'Navigate the analytics dashboard, apply filters, and interpret the data.',
        body: `
          <h2>Accessing Metrics</h2>
          <p>Go to <strong>Metrics</strong> in the sidebar. This page is available to <strong>Company Admins</strong> and <strong>Talkpush Owners</strong>.</p>

          <h2>Dashboard Filters</h2>
          <ul>
            <li><strong>Date Range</strong> &mdash; Select start and end dates to filter by submission period</li>
            <li><strong>Campaign</strong> &mdash; Filter metrics for a specific campaign</li>
            <li><strong>Agency</strong> &mdash; Filter metrics for a specific agency</li>
          </ul>

          <h2>Key Metrics</h2>
          <table class="ref-table">
            <tr><th>Metric</th><th>Description</th></tr>
            <tr><td><strong>Total Submissions</strong></td><td>Number of candidates submitted in the selected period</td></tr>
            <tr><td><strong>Added</strong></td><td>New candidates (no prior submission)</td></tr>
            <tr><td><strong>Previously Submitted</strong></td><td>Candidates the same agency already submitted</td></tr>
            <tr><td><strong>Duplicates</strong></td><td>Candidates owned by another source</td></tr>
            <tr><td><strong>Submissions by Agency</strong></td><td>Breakdown of submissions per agency</td></tr>
            <tr><td><strong>Submissions by Campaign</strong></td><td>Breakdown of submissions per campaign</td></tr>
          </table>

          <div class="info-box tip">
            <strong>Tip</strong>
            Use the date range filter to compare performance across different periods (e.g., this month vs. last month).
          </div>
        `
      },
      {
        id: 'reports-export',
        title: 'Reports & Excel Export',
        subtitle: 'Generate and download reports of candidate data in Excel format.',
        body: `
          <h2>Generating Reports</h2>
          <p>The <strong>Reports</strong> section (available to Company Admins and Talkpush Owners) allows you to export candidate data as Excel spreadsheets.</p>

          <h2>How to Export</h2>
          <ol>
            <li>Navigate to the <strong>Reports</strong> section</li>
            <li>Apply your desired filters (date range, campaign, agency)</li>
            <li>Click <strong>"Export to Excel"</strong></li>
            <li>The file will download automatically</li>
          </ol>

          <h2>What's Included in the Export</h2>
          <p>The Excel export includes all candidate fields: name, email, phone, campaign, agency, tag, submission date, and CRM status. This is useful for offline analysis, sharing with stakeholders, or compliance reporting.</p>
        `
      }
    ]
  },

  /* ================================================================
     10. COMMENTS & CRM SYNC
     ================================================================ */
  {
    id: 'comments-crm',
    title: 'Comments & CRM Sync',
    description: 'Add comments to candidates and understand bidirectional sync with the Talkpush CRM.',
    icon: '\u{1F4AC}',
    iconBg: '#FFF8E1',
    articleCount: 2,
    articles: [
      {
        id: 'adding-comments',
        title: 'Adding Comments to Candidates',
        subtitle: 'Post notes and updates that sync to the Talkpush CRM.',
        body: `
          <h2>How to Add a Comment</h2>
          <ol>
            <li>Open a candidate's <strong>detail page</strong></li>
            <li>Scroll to the <strong>Comments</strong> section</li>
            <li>Type your comment in the text field</li>
            <li>Click <strong>"Post"</strong></li>
          </ol>

          <h2>What Gets Synced</h2>
          <p>When you post a comment in the portal, it is automatically sent to the <strong>Talkpush CRM</strong> as a note on the candidate's record. The comment includes your name and timestamp.</p>

          <h2>Comment Guidelines</h2>
          <ul>
            <li>Use comments to record interview feedback, status updates, or important notes</li>
            <li>Comments are visible to all users who can access the candidate's detail page</li>
            <li>Comments cannot be edited or deleted after posting</li>
          </ul>

          <div class="info-box">
            <strong>Note</strong>
            Comments added in the Talkpush CRM also appear in the portal, making this a fully bidirectional communication channel between internal teams and agencies.
          </div>
        `
      },
      {
        id: 'crm-sync',
        title: 'Understanding CRM Synchronization',
        subtitle: 'How data flows between the Agency Portal and the Talkpush CRM.',
        body: `
          <h2>What Syncs to the CRM</h2>
          <table class="ref-table">
            <tr><th>Data</th><th>Direction</th><th>When</th></tr>
            <tr><td>Candidate profile</td><td>Portal &rarr; CRM</td><td>When a candidate is submitted</td></tr>
            <tr><td>Resume document</td><td>Portal &rarr; CRM</td><td>Immediately after candidate creation</td></tr>
            <tr><td>AI resume summary</td><td>Portal &rarr; CRM</td><td>During candidate creation</td></tr>
            <tr><td>Comments/notes</td><td>Both directions</td><td>When a comment is added</td></tr>
            <tr><td>Withdrawal status</td><td>Portal &rarr; CRM</td><td>When a candidate is withdrawn</td></tr>
            <tr><td>Pipeline stage/folder</td><td>CRM &rarr; Portal</td><td>When viewing candidate detail</td></tr>
            <tr><td>Rejection notes</td><td>CRM &rarr; Portal</td><td>When viewing candidate detail</td></tr>
          </table>

          <h2>Sync Timing</h2>
          <p>Most synchronization happens in <strong>real time</strong>. Candidate submissions, resume uploads, and comments sync immediately. CRM stage information is fetched on-demand when you open a candidate's detail page.</p>

          <div class="info-box tip">
            <strong>Tip</strong>
            If a candidate's CRM stage seems outdated, refresh the candidate detail page to fetch the latest status from the CRM.
          </div>
        `
      }
    ]
  },

  /* ================================================================
     11. COMPANY MANAGEMENT
     ================================================================ */
  {
    id: 'company-management',
    title: 'Company Management',
    description: 'Set up and manage companies (tenants), configure branding, and understand multi-tenancy.',
    icon: '\u{1F3DB}\uFE0F',
    iconBg: '#EFEBE9',
    articleCount: 2,
    articles: [
      {
        id: 'multi-tenancy',
        title: 'Understanding Multi-Tenancy',
        subtitle: 'How the portal supports multiple companies with isolated data.',
        body: `
          <h2>What is Multi-Tenancy?</h2>
          <p>The Agency Portal supports <strong>multiple companies</strong> (tenants) within a single installation. Each company operates independently with its own agencies, campaigns, countries, and candidates. Data is fully isolated between companies.</p>

          <h2>Who Manages Companies?</h2>
          <p>Only <strong>Talkpush Owners</strong> can create and manage companies. Company Admins are scoped to a single company and cannot see other companies' data.</p>

          <h2>Company Context</h2>
          <p>Talkpush Owners can switch between companies using the <strong>company selector</strong> at the top of the page. When a company is selected, all views are filtered to that company's data. This makes it easy to manage multiple client deployments from a single account.</p>
        `
      },
      {
        id: 'company-settings',
        title: 'Company Settings & Branding',
        subtitle: 'Configure company details, branding, and portal appearance.',
        body: `
          <h2>Company Properties</h2>
          <table class="ref-table">
            <tr><th>Field</th><th>Description</th></tr>
            <tr><td><strong>Company Name</strong></td><td>Internal name used in the system</td></tr>
            <tr><td><strong>Brand Name</strong></td><td>Display name shown to users</td></tr>
            <tr><td><strong>Portal URL</strong></td><td>The URL where the portal is hosted for this company</td></tr>
            <tr><td><strong>Sender Email</strong></td><td>Email address used for system notifications</td></tr>
          </table>

          <h2>Managing Companies</h2>
          <ol>
            <li>Go to <strong>Company</strong> in the sidebar (Talkpush Owner only)</li>
            <li>View the list of existing companies</li>
            <li>Click <strong>"Add Company"</strong> to create a new one, or click the edit icon to modify an existing company</li>
          </ol>
        `
      }
    ]
  },

  /* ================================================================
     12. DATA IMPORT
     ================================================================ */
  {
    id: 'data-import',
    title: 'Data Import & Cleanup',
    description: 'Import historical candidate data and use cleanup tools for data management.',
    icon: '\u{1F4E5}',
    iconBg: '#E0F2F1',
    articleCount: 2,
    articles: [
      {
        id: 'importing-data',
        title: 'Importing Historical Data',
        subtitle: 'How to bulk-import candidate records from external sources.',
        body: `
          <h2>Who Can Import Data?</h2>
          <p>Only <strong>Talkpush Owners</strong> have access to the data import functionality.</p>

          <h2>Import Process</h2>
          <ol>
            <li>Go to <strong>Import Data</strong> in the sidebar</li>
            <li>Select the appropriate import type</li>
            <li>Follow the on-screen instructions to upload your data</li>
            <li>Review the import preview to verify accuracy</li>
            <li>Confirm the import</li>
          </ol>

          <div class="info-box warning">
            <strong>Important</strong>
            Data imports should be performed carefully. Always verify the preview before confirming. Imported data cannot be easily reversed.
          </div>

          <h2>When to Use Import</h2>
          <ul>
            <li><strong>Initial setup</strong> &mdash; Loading historical candidate data when onboarding a new company</li>
            <li><strong>Migration</strong> &mdash; Moving data from another system to the Agency Portal</li>
            <li><strong>Bulk updates</strong> &mdash; Updating records in bulk from an external source</li>
          </ul>
        `
      },
      {
        id: 'data-cleanup',
        title: 'Data Cleanup Tools',
        subtitle: 'Use cleanup utilities to manage and maintain data quality.',
        body: `
          <h2>Available Cleanup Tools</h2>
          <p>The Import Data section also provides utilities for managing data quality:</p>
          <ul>
            <li><strong>Duplicate resolution</strong> &mdash; Identify and manage duplicate records</li>
            <li><strong>Data validation</strong> &mdash; Check for incomplete or invalid records</li>
            <li><strong>Bulk status updates</strong> &mdash; Update multiple records at once</li>
          </ul>

          <div class="info-box">
            <strong>Note</strong>
            These tools are designed for administrative use only. Contact the Talkpush team if you need assistance with large-scale data operations.
          </div>
        `
      }
    ]
  },

  /* ================================================================
     13. PROFILE & SECURITY
     ================================================================ */
  {
    id: 'profile-security',
    title: 'Profile & Security',
    description: 'Manage your personal profile, change your password, and understand security features.',
    icon: '\u{1F512}',
    iconBg: '#FBE9E7',
    articleCount: 2,
    articles: [
      {
        id: 'edit-profile',
        title: 'Editing Your Profile',
        subtitle: 'Update your personal information and profile settings.',
        body: `
          <h2>Accessing Your Profile</h2>
          <ol>
            <li>Click your <strong>name/avatar</strong> in the top-right corner</li>
            <li>Select <strong>"Edit Profile"</strong></li>
          </ol>

          <h2>What You Can Update</h2>
          <ul>
            <li><strong>First Name</strong> and <strong>Last Name</strong></li>
            <li><strong>Email Address</strong> (must be unique in the system)</li>
            <li><strong>Password</strong> (requires current password for verification)</li>
          </ul>

          <h2>Changing Your Password</h2>
          <ol>
            <li>On the profile page, locate the password section</li>
            <li>Enter your <strong>current password</strong></li>
            <li>Enter and confirm your <strong>new password</strong></li>
            <li>Click <strong>"Save"</strong></li>
          </ol>
        `
      },
      {
        id: 'security-features',
        title: 'Security Features',
        subtitle: 'Learn about session management, password policies, and access controls.',
        body: `
          <h2>Session Management</h2>
          <p>Your session is stored securely on the server. Sessions are configured with standard timeout policies to protect your account.</p>

          <h2>Password Security</h2>
          <ul>
            <li>Passwords are <strong>hashed and salted</strong> using industry-standard algorithms</li>
            <li>Activation links expire after <strong>7 days</strong></li>
            <li>Password reset links expire after <strong>1 hour</strong></li>
          </ul>

          <h2>Access Controls</h2>
          <ul>
            <li>Every page and API endpoint checks your <strong>role and permissions</strong></li>
            <li>Users cannot escalate their own permissions</li>
            <li>All sensitive actions are logged</li>
            <li>Disabled accounts are immediately locked out</li>
          </ul>

          <div class="info-box tip">
            <strong>Tip</strong>
            Always log out when using shared or public computers. Click your name in the top-right corner and select "Log Out."
          </div>
        `
      }
    ]
  },

  /* ================================================================
     14. FAQ & TROUBLESHOOTING
     ================================================================ */
  {
    id: 'faq',
    title: 'FAQ & Troubleshooting',
    description: 'Answers to common questions and solutions to frequent issues.',
    icon: '\u{2753}',
    iconBg: '#FFF9C4',
    articleCount: 3,
    articles: [
      {
        id: 'faq-general',
        title: 'General FAQ',
        subtitle: 'Answers to the most commonly asked questions about the Agency Portal.',
        body: `
          <h2>Q: Why can't I see certain campaigns?</h2>
          <p><strong>A:</strong> Campaigns must be assigned to your agency by an administrator. If you don't see a campaign you expect, contact your Company Admin to request access.</p>

          <h2>Q: What happens when I submit a duplicate candidate?</h2>
          <p><strong>A:</strong> The system automatically detects duplicates based on email address within the same campaign. The candidate will be tagged as <strong>"Duplicate"</strong> (if owned by another source) or <strong>"Previously Submitted"</strong> (if your agency already submitted them). The submission is still recorded in your list.</p>

          <h2>Q: Can I delete a candidate I submitted?</h2>
          <p><strong>A:</strong> No, candidates cannot be deleted. You can <strong>withdraw</strong> a candidate, which marks them as withdrawn in both the portal and the CRM. This is a permanent action.</p>

          <h2>Q: How do I know if my candidate was synced to the CRM?</h2>
          <p><strong>A:</strong> Open the candidate's detail page. If the candidate has a <strong>Talkpush Lead ID</strong> and shows a pipeline stage, they have been successfully synced with the CRM.</p>

          <h2>Q: Can I submit the same candidate to multiple campaigns?</h2>
          <p><strong>A:</strong> Yes! Duplicate detection is per-campaign. A candidate can be submitted to different campaigns without being flagged as a duplicate.</p>
        `
      },
      {
        id: 'troubleshooting',
        title: 'Troubleshooting Common Issues',
        subtitle: 'Solutions for login problems, submission errors, and sync issues.',
        body: `
          <h2>I can't log in</h2>
          <ul>
            <li>Check that you're using the correct <strong>email address</strong></li>
            <li>Try the <strong>"Forgot Password?"</strong> flow to reset your password</li>
            <li>Your account may be <strong>disabled</strong> &mdash; contact your administrator</li>
            <li>Your activation link may have <strong>expired</strong> &mdash; ask your admin to resend it</li>
          </ul>

          <h2>My candidate submission failed</h2>
          <ul>
            <li>Check that all <strong>required fields</strong> are filled in</li>
            <li>Ensure the resume file is a <strong>PDF or DOCX</strong></li>
            <li>Verify the candidate's <strong>email address</strong> is valid</li>
            <li>If the error persists, the CRM connection may be temporarily unavailable &mdash; try again in a few minutes</li>
          </ul>

          <h2>The candidate stage isn't showing</h2>
          <ul>
            <li>Stage visibility may be <strong>disabled for your country</strong> &mdash; check with your administrator</li>
            <li>The candidate may not have been <strong>synced to the CRM</strong> yet</li>
            <li>Try <strong>refreshing the page</strong> to fetch the latest data</li>
          </ul>

          <h2>I don't see the Agency Pool</h2>
          <p><strong>Agency Users</strong> do not have access to the Agency Pool. Only Agency Admins, Company Admins, and Talkpush Owners can see it. If you believe you should have access, contact your administrator.</p>
        `
      },
      {
        id: 'glossary',
        title: 'Glossary of Terms',
        subtitle: 'Key terminology used throughout the Agency Portal.',
        body: `
          <h2>Glossary</h2>
          <table class="ref-table">
            <tr><th>Term</th><th>Definition</th></tr>
            <tr><td><strong>Agency</strong></td><td>An external staffing or recruitment firm that submits candidates</td></tr>
            <tr><td><strong>Agency Pool</strong></td><td>The cross-agency view showing all candidates from multiple agencies</td></tr>
            <tr><td><strong>Campaign</strong></td><td>A recruitment position/job opening mapped to the Talkpush CRM</td></tr>
            <tr><td><strong>Candidate</strong></td><td>A person submitted as a referral for a specific campaign</td></tr>
            <tr><td><strong>CRM</strong></td><td>Customer Relationship Management &mdash; the Talkpush system that manages recruitment workflows</td></tr>
            <tr><td><strong>Duplicate</strong></td><td>A candidate already submitted by another source within the ownership window</td></tr>
            <tr><td><strong>Folder</strong></td><td>A pipeline stage in the Talkpush CRM (e.g., Screening, Interview, Offer)</td></tr>
            <tr><td><strong>Lead ID</strong></td><td>The unique identifier for a candidate in the Talkpush CRM</td></tr>
            <tr><td><strong>Ownership Window</strong></td><td>The configurable time period during which a candidate "belongs" to the first submitting agency</td></tr>
            <tr><td><strong>Previously Submitted</strong></td><td>A candidate your agency has already submitted to the same campaign</td></tr>
            <tr><td><strong>Tag</strong></td><td>A color-coded label indicating candidate submission status (Added, Previously Submitted, Duplicate)</td></tr>
            <tr><td><strong>Tenant</strong></td><td>A company in the multi-tenant system, with isolated data</td></tr>
          </table>
        `
      }
    ]
  }
];

// --- SEARCH INDEX ---
function buildSearchIndex() {
  const index = [];
  COLLECTIONS.forEach(col => {
    col.articles.forEach(art => {
      const text = (art.title + ' ' + art.subtitle + ' ' + art.body).replace(/<[^>]+>/g, '').toLowerCase();
      index.push({
        collectionId: col.id,
        collectionTitle: col.title,
        articleId: art.id,
        title: art.title,
        subtitle: art.subtitle,
        text: text
      });
    });
  });
  return index;
}

const searchIndex = buildSearchIndex();

// --- ROUTING ---
function navigateTo(view, id, collectionId) {
  if (view === 'home') {
    window.location.hash = '';
  } else if (view === 'collection') {
    window.location.hash = '#collection/' + id;
  } else if (view === 'article') {
    window.location.hash = '#article/' + collectionId + '/' + id;
  }
}

function parseHash() {
  const hash = window.location.hash.replace('#', '');
  if (!hash) return { view: 'home' };
  const parts = hash.split('/');
  if (parts[0] === 'collection') return { view: 'collection', id: parts[1] };
  if (parts[0] === 'article') return { view: 'article', collectionId: parts[1], id: parts[2] };
  if (parts[0] === 'search') return { view: 'search', query: decodeURIComponent(parts.slice(1).join('/')) };
  return { view: 'home' };
}

// --- RENDERING ---
function render() {
  const route = parseHash();
  const app = document.getElementById('app');
  const header = document.getElementById('site-header');
  const searchInput = document.getElementById('search-input');
  const headerTitle = document.getElementById('header-title');

  // Reset search
  if (route.view !== 'search') {
    searchInput.value = '';
  }

  // Header style
  if (route.view === 'home') {
    header.className = 'header';
    headerTitle.textContent = 'How can we help?';
  } else {
    header.className = 'header compact';
    headerTitle.textContent = 'Agency Portal Help Center';
  }

  // Render view
  if (route.view === 'home') {
    renderHome(app);
  } else if (route.view === 'collection') {
    renderCollection(app, route.id);
  } else if (route.view === 'article') {
    renderArticle(app, route.collectionId, route.id);
  } else if (route.view === 'search') {
    renderSearchResults(app, route.query);
  }

  // Scroll to top
  window.scrollTo(0, 0);
}

function renderHome(app) {
  let html = '<div class="view-transition"><div class="collections-grid">';
  COLLECTIONS.forEach(col => {
    html += `
      <div class="collection-card" onclick="navigateTo('collection', '${col.id}')">
        <div class="collection-card-icon" style="background:${col.iconBg}">${col.icon}</div>
        <h3>${col.title}</h3>
        <p>${col.description}</p>
        <div class="collection-card-meta">
          <div class="avatar">AP</div>
          <span>${col.articleCount} article${col.articleCount !== 1 ? 's' : ''}</span>
        </div>
      </div>`;
  });
  html += '</div></div>';
  app.innerHTML = html;
}

function renderCollection(app, collectionId) {
  const col = COLLECTIONS.find(c => c.id === collectionId);
  if (!col) { renderHome(app); return; }

  let html = `<div class="view-transition">
    <div class="breadcrumbs">
      <a href="#" onclick="navigateTo('home'); return false;">All Collections</a>
      <span class="sep">\u203A</span>
      <span class="current">${col.title}</span>
    </div>
    <div class="collection-header">
      <div class="collection-header-icon" style="background:${col.iconBg}">${col.icon}</div>
      <div class="collection-header-info">
        <h2>${col.title}</h2>
        <p class="meta">${col.articleCount} article${col.articleCount !== 1 ? 's' : ''}</p>
      </div>
    </div>
    <ul class="article-list">`;

  col.articles.forEach(art => {
    html += `<li><a href="#" onclick="navigateTo('article', '${art.id}', '${col.id}'); return false;">
      <span class="article-title">${art.title}</span>
      <span class="chevron">\u203A</span>
    </a></li>`;
  });

  html += `</ul>
    <a class="back-to-top" onclick="navigateTo('home'); return false;">\u2190 Back to all collections</a>
  </div>`;
  app.innerHTML = html;
}

function renderArticle(app, collectionId, articleId) {
  const col = COLLECTIONS.find(c => c.id === collectionId);
  if (!col) { renderHome(app); return; }
  const art = col.articles.find(a => a.id === articleId);
  if (!art) { renderCollection(app, collectionId); return; }

  let html = `<div class="view-transition">
    <div class="breadcrumbs">
      <a href="#" onclick="navigateTo('home'); return false;">All Collections</a>
      <span class="sep">\u203A</span>
      <a href="#" onclick="navigateTo('collection', '${col.id}'); return false;">${col.title}</a>
      <span class="sep">\u203A</span>
      <span class="current">${art.title}</span>
    </div>
    <div class="article-header">
      <h1>${art.title}</h1>
      <p class="subtitle">${art.subtitle}</p>
      <div class="article-meta">
        <div class="avatar">AP</div>
        <span>Agency Portal Team</span>
        <span>&middot;</span>
        <span>Updated February 2026</span>
      </div>
    </div>
    <div class="article-body">${art.body}</div>
    <a class="back-to-top" onclick="navigateTo('collection', '${col.id}'); return false;">\u2190 Back to ${col.title}</a>
  </div>`;
  app.innerHTML = html;
}

function renderSearchResults(app, query) {
  const q = query.toLowerCase().trim();
  const results = searchIndex.filter(item => item.text.includes(q));

  let html = `<div class="view-transition">
    <div class="breadcrumbs">
      <a href="#" onclick="navigateTo('home'); return false;">All Collections</a>
      <span class="sep">\u203A</span>
      <span class="current">Search results</span>
    </div>
    <div class="search-results">
      <h2>${results.length} result${results.length !== 1 ? 's' : ''} for "${query}"</h2>`;

  if (results.length === 0) {
    html += `<p style="color:var(--text-secondary);margin-top:16px;">No articles found matching your search. Try different keywords or <a href="#" onclick="navigateTo('home'); return false;" style="color:var(--purple-mid);">browse all collections</a>.</p>`;
  } else {
    results.forEach(r => {
      // Extract snippet
      const idx = r.text.indexOf(q);
      const start = Math.max(0, idx - 60);
      const end = Math.min(r.text.length, idx + q.length + 100);
      let snippet = (start > 0 ? '...' : '') + r.text.slice(start, end) + (end < r.text.length ? '...' : '');
      // Bold the match
      snippet = snippet.replace(new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'), '<strong>$&</strong>');

      html += `<div class="search-result-item" onclick="navigateTo('article', '${r.articleId}', '${r.collectionId}')">
        <h4>${r.title}</h4>
        <div class="collection-name">${r.collectionTitle}</div>
        <p>${snippet}</p>
      </div>`;
    });
  }

  html += `</div>
    <a class="back-to-top" onclick="navigateTo('home'); return false;">\u2190 Back to all collections</a>
  </div>`;
  app.innerHTML = html;
}

// --- SEARCH HANDLER ---
let searchTimeout;
function handleSearch(value) {
  clearTimeout(searchTimeout);
  if (!value.trim()) {
    if (parseHash().view === 'search') navigateTo('home');
    return;
  }
  searchTimeout = setTimeout(() => {
    window.location.hash = '#search/' + encodeURIComponent(value.trim());
  }, 300);
}

// --- INIT ---
window.addEventListener('hashchange', render);
window.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
